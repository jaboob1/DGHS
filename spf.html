<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8">
  <title>حاسبة الراتب التقاعدي (احتساب قديم + جديد)</title>
  <style>
    body{direction:rtl; font-family:Tahoma,Arial,sans-serif; background:#f7f9fb; padding:20px; color:#111}
    .card{background:#fff; border-radius:8px; padding:18px; box-shadow:0 2px 8px rgba(0,0,0,0.06); max-width:950px; margin:0 auto}
    h1{font-size:20px; margin-bottom:10px}
    label{display:block; margin:8px 0 4px}
    input{padding:6px 8px; border:1px solid #ccc; border-radius:4px; width:220px}
    button{margin-top:12px; padding:8px 14px; background:#2b6cb0; color:#fff; border:none; border-radius:6px; cursor:pointer}
    button:hover{background:#1a4f80}
    table{width:100%; border-collapse:collapse; margin-top:14px}
    th,td{padding:8px 10px; border-bottom:1px solid #eee; font-size:14px}
    th{background:#fafafa}
    .summary{margin-top:16px; display:flex; gap:12px; flex-wrap:wrap}
    .box{background:#f1f6fb; padding:12px; border-radius:6px; min-width:220px}
    strong{color:#2b6cb0}
    .formula{margin-top:18px; padding:12px; background:#fffbea; border:1px solid #f0e6a6; border-radius:6px; line-height:1.6}
  </style>
</head>
<body>
  <div class="card">
    <h1>حاسبة الراتب التقاعدي (احتساب قديم + جديد)</h1>

    <form id="inputs">
      <label>الراتب الأخير في ديسمبر 2023م:</label>
      <input type="number" id="salaryStart" value="875" step="0.01">

      <label>عدد السنوات السابقة قبل سنة 2024م:</label>
      <input type="number" id="prevYears" value="13">

      <label>عدد السنوات المستقبلية بعد يناير 2024م:</label>
      <input type="number" id="futureYears" value="20">

      <label>نسبة النمو السنوي للأجور (%3):</label>
      <input type="number" id="growthRate" value="3" step="0.01">

      <br>
      <button type="button" onclick="calculate()">احسب</button>
    </form>

    <table id="salaryTable">
      <thead>
        <tr>
          <th>السنة</th>
          <th>الراتب المتوقع (ريال)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="summary">
      <div class="box">
        <div><strong>الخدمة السابقة قبل 2024م</strong></div>
        <div>المعادلة: 2% × الراتب الأخير ديسمبر 2023 × السنوات السابقة قبل يناير 2024م</div>
        <div>النتيجة: <strong id="prevPart">--</strong> ريال</div>
      </div>

      <div class="box">
        <div><strong>الخدمة المستقبلية ما بعد يناير 2024م </strong></div>
        <div>المعادلة: 2% × متوسط الأجر × السنوات المستقبلية ما بعد يناير 2024م</div>
        <div>متوسط الأجر: <strong id="avgSalary">--</strong> ريال</div>
        <div>النتيجة: <strong id="futurePart">--</strong> ريال</div>
      </div>

      <div class="box">
        <div><strong>المعاش التقاعدي المتوقع</strong></div>
        <div style="font-size:18px">المجموع: <strong id="totalPension">--</strong> ريال</div>
      </div>
    </div>

    <div class="formula" id="formulaText"></div>
  </div>

<script>
function format(x){return Number(x).toLocaleString('ar-EG',{minimumFractionDigits:2, maximumFractionDigits:2});}

function calculate(){
  let salaryStart = parseFloat(document.getElementById('salaryStart').value) || 0;
  let prevYears = parseInt(document.getElementById('prevYears').value) || 0;
  let futureYears = parseInt(document.getElementById('futureYears').value) || 0;
  let growthRate = parseFloat(document.getElementById('growthRate').value) || 0;

  let g = growthRate/100;
  let tbody = document.querySelector('#salaryTable tbody');
  tbody.innerHTML = '';
  let salaries = [];

  // نمو الأجور يبدأ من الراتب الأخير مباشرة
  for(let i=1; i<=futureYears; i++){
    let year = 2024 + i;
    let salary = salaryStart * Math.pow(1+g, i);
    salaries.push(salary);
    let tr = document.createElement('tr');
    tr.innerHTML = `<td>${year}</td><td>${format(salary)}</td>`;
    tbody.appendChild(tr);
  }

  // متوسط الأجر للخدمة المستقبلية
  let avgSalary = salaries.reduce((a,b)=>a+b,0)/salaries.length;

  // حساب أجزاء المعاش (معامل 2%)
  let prevPart = salaryStart * (prevYears * 0.02);   // ← باستخدام الراتب الأخير فقط
  let futurePart = avgSalary * (futureYears * 0.02);
  let total = prevPart + futurePart;

  // عرض النتائج
  document.getElementById('prevPart').textContent = format(prevPart);
  document.getElementById('avgSalary').textContent = format(avgSalary);
  document.getElementById('futurePart').textContent = format(futurePart);
  document.getElementById('totalPension').textContent = format(total);

  // توضيح كتابي للمعادلة
  document.getElementById('formulaText').innerHTML = `
    <strong>توضيح الحساب:</strong><br>
    • <u>الخدمة السابقة (${prevYears} سنة)</u> = 2% × ${format(salaryStart)} × ${prevYears} = <strong>${format(prevPart)} ريال</strong><br>
    • <u>الخدمة المستقبلية (${futureYears} سنة)</u> = 2% × ${format(avgSalary)} × ${futureYears} = <strong>${format(futurePart)} ريال</strong><br>
    • <u>المعاش الكلي</u> = ${format(prevPart)} + ${format(futurePart)} = <strong>${format(total)} ريال</strong>
  `;
}
</script>
</body>
</html>